## Analyze a sensor performance
To analyze a sensor performance the script [analyzeSensorUsingGridDataset.m](https://github.com/robotology-playground/insitu-ft-analysis/blob/master/analizeSensorUsingGridDataset.m) can be used.

This script take dataset in the "grid" format (generated by [sensorSelfCalibrator][1] module and copied to [greeny datasets][2] 
with the according params.m file [2] ) on the iCub robot and compare the eccentrity of the force measurement. In theory the "grid" movement is slowly (so the only thing that matters is gravity) moving the legs, while the robot is fixed on the pole (so the only external force are on the root_link).

The measured force should be equal to m*g , where g \in R^3 is the gravity expressed in the sensor frame. Hence the measured force should lie on a sphere (eccentrities 0,0) in theory. However imperfect sensor can have a different eccentricities ( but in general they remain linear, so the sphere become an ellipsoid).
For more on the theory behind this script, check [1,2].

1. : [Traversaro, Silvio, Daniele Pucci, and Francesco Nori.
      "In situ calibration of six-axis force-torque sensors using accelerometer measurements."
      Robotics and Automation (ICRA), 2015 IEEE International Conference on. IEEE, 2015.](http://ieeexplore.ieee.org/document/7139477/)
2. : [F. J. A. Chavez, S. Traversaro, D. Pucci and F. Nori, 
      "Model based in situ calibration of six axis force torque sensors," 
      2016 IEEE-RAS 16th International Conference on Humanoid Robots (Humanoids), Cancun, 2016](http://ieeexplore.ieee.org/document/7803310/)


[1]:https://github.com/robotology-playground/sensors-calib-inertial/tree/feature/integrateFTSensors
[2]:https://github.com/robotology-playground/insitu-ft-analysis/blob/master/docs/yarpManagerApps/statesAndFtSensorsInertial.xml

The experiment name t should be inserted in the `experimentName='';` variable  with the complete path to it as seen from the data directory. The required configuration options for reading the file are:

```
scriptOptions = {};
scriptOptions.forceCalculation=true;
scriptOptions.printPlots=true;
scriptOptions.raw=false;
scriptOptions.saveData=true;
scriptOptions.testDir=false;% to calculate the raw data, for recalibration always true
scriptOptions.filterData=true;
scriptOptions.estimateWrenches=true;
scriptOptions.useInertial=false;
scriptOptions.matFileName='iCubDataset';
```


The function `readExperiment` is used for a deeper understading you can read [How to read an experiment](https://github.com/robotology-playground/insitu-ft-analysis/blob/master/docs/howToFiles/readAnExperiment.md).

### Undestanding the results
The script will do the comparison of the resulting ellipsoid of the measured forces against the estimated forces.
![wrench space](https://user-images.githubusercontent.com/11043189/33688555-139209ec-dadc-11e7-8593-d882f83b2969.png)

For doing this it attempts to fit ellipsoid to the measured data in two ways:
- One is to take advantage of the fact that we know we expect a sphere so we add the measured data to further fit towards what we would expect should be
- Second we try to fit the measured data alone without taking advantage of the model.
If the model can be reasonably trusted it is prefered to look at the results of actually using the model.

Besides showing some nice plots for visual inspection the script will throw also a series of messages for every desired sensor to be analized for example if we are analysing the right leg sensor (`sensorsToAnalize = {'right_leg'};`) :
```
The apparent mass attached (using gravity from kinematics) at the sensor right_leg for axis x,y,z are (5.227913,6.971536,4.942367)
The apparent mass attached (without using the model) at the sensor right_leg for axis x,y,z are (6.068035,7.488945,6.221753)
The mass attached to the sensor right_leg (from the model) is (4.733288)

The standard deviation among the axis of right_leg sensor  is 1.098429
The standard deviation among the axis (without using the model) of right_leg sensor  is 0.779785
The error at the sensor right_leg for axis x,y,z are (4.852270 N ,21.957204 N ,2.051057 N)
The error (without using the model) at the sensor right_leg for axis x,y,z are (13.093867 N ,27.032994 N ,14.601840 N)
```
A perfect result would give us a sphere with a mass equal to the one we obtain using the model (if we trust the model). In general we are looking for symmetry of the axis of the resulting ellipsoid so for a quick inspection and comparison with other sensors we can look at the resulting value of the standard deviation:

>The standard deviation among the axis of right_leg sensor  is 1.098429

As a general rule the smaller the better. In this message example the result is 1.098429 which is a bad result. This is more intuitive when we look at the error message:

>The error at the sensor right_leg for axis x,y,z are (4.852270 N ,21.957204 N ,2.051057 N)

From this we can expect that our measurments can have an error aprox of what is shown. In this case the biggest source of error is in the y axis (which is usually the case in most the insitu tests seen so far) with an error of 21.957204 N aprox.


An example of a good performance experiment name is
`
experimentName='/dataSamples/TestGrid';
`

The results of this experiment can be seen in [testGrid results](https://github.com/loc2/component_ft-sensors/issues/1#issuecomment-349795695).

An example of a bad performance experiment can be seen [here](https://github.com/robotology-playground/insitu-ft-analysis/issues/8#issuecomment-341704784)
